<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Meta -->
    <meta name="description" content="Responsive Bootstrap4 Dashboard Template">
    <meta name="author" content="ParkerThemes">
    <link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/AiPacino/kuaidashboard@main/assets/img/fav.png"/>
    <meta http-equiv="Access-Control-Allow-Origin" content="*"/>

    <!-- Title -->
    <title>当前页面</title>

    <!-- *************
        ************ Common Css Files *************
    ************ -->
    <!-- Bootstrap css -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css">
    <!-- Icomoon Font Icons css -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/AiPacino/kuaidashboard@main/assets/fonts/style.css">
    <!-- Main css -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/AiPacino/kuaidashboard@main/assets/css/main.css">

    <!-- Bootstrap Select CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/AiPacino/kuaidashboard@main/assets/vendor/bs-select/bs-select.css"/>
    <!-- *************
        ************ Vendor Css Files *************
    ************ -->
    <!-- DateRange css -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/AiPacino/kuaidashboard@main/assets/vendor/daterange/daterange.css"/>

    <!-- Notify -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/AiPacino/kuaidashboard@main/assets/vendor/notify/notify-flat.css"/>


</head>
<body>

<!-- Loading starts -->
<div id="loading-wrapper">
    <div class="spinner-border" role="status">
        <span class="sr-only">Loading...</span>
    </div>
</div>
<!-- Loading ends -->


<!-- Page wrapper start -->
<div class="page-wrapper" id="main">

    <!-- Sidebar wrapper start -->
    <nav id="sidebar" class="sidebar-wrapper">

        <!-- Sidebar brand start  -->
        <div class="sidebar-brand">
            <a href="../homepage/index.html" class="logo">
                <img src="https://cdn.jsdelivr.net/gh/AiPacino/kuaidashboard@main/assets/img/logo.png" alt="销售统计"/>
            </a>
        </div>
        <!-- Sidebar brand end  -->

        <!-- Sidebar content start -->
        <div class="sidebar-content">

            <!-- sidebar menu start -->
            <div class="sidebar-menu">
                <ul>
                    <li class="header-menu">常规</li>
                    <li>
                        <a href="/dashboard/dashboard.html">
                            <i class="icon-eye1"></i>
                            <span class="menu-text">销售统计</span>
                        </a>
                    </li>
                    <li>
                        <a href="/dashboard/pages.html">
                            <i class="icon-local_mall"></i>
                            <span class="menu-text">全部收款</span>
                        </a>
                    </li>
                    <li>
                        <a href="/dashboard/account.html">
                            <i class="icon-settings1"></i>
                            <span class="menu-text">账户设置</span>
                        </a>
                    </li>
                </ul>
            </div>
            <!-- sidebar menu end -->

        </div>
        <!-- Sidebar content end -->

    </nav>
    <!-- Sidebar wrapper end -->

    <!-- Page content start  -->
    <div class="page-content">

        <!-- Header start -->
        <header class="header">
            <div class="toggle-btns">
                <a id="toggle-sidebar" href="/account.html">
                    <i class="icon-list"></i>
                </a>
                <a id="pin-sidebar" href="/account.html">
                    <i class="icon-list"></i>
                </a>
            </div>
            <div class="header-items">
                <!-- Header actions start -->
                <ul class="header-actions">
                    <li class="dropdown">
                        <a href="../homepage/index.html#" id="userSettings" class="user-settings" data-toggle="dropdown"
                           aria-haspopup="true">
                            <span class="user-name" id="username-bar">${username}</span>
                            <span class="avatar">
										<img src="https://cdn.jsdelivr.net/gh/AiPacino/kuaidashboard@main/assets/img/user24.png" alt="avatar">
										<span class="status busy"></span>
									</span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="userSettings">
                            <div class="header-profile-actions">
                                <div class="header-user-profile">
                                    <div class="header-user">
                                        <img src="https://cdn.jsdelivr.net/gh/AiPacino/kuaidashboard@main/assets/img/user24.png" alt="Admin Template">
                                    </div>
                                    <h5 class="user-name">${username}</h5>
                                </div>
                                <a id="account-settings" href="/account"><i class="icon-settings1"></i>账户设置</a>
                                <a type="button" onclick="SignOut()"><i class="icon-log-out1"></i>退出登录</a>
                            </div>
                        </div>
                    </li>
                </ul>
                <!-- Header actions end -->
            </div>
        </header>
        <!-- Header end -->

        <!-- Page header start -->
        <div class="page-header">
            <ol class="breadcrumb">
                <li class="breadcrumb-item">主页</li>
                <li class="breadcrumb-item active">账户设置</li>
            </ol>
        </div>
        <!-- Page header end -->

        <!-- Main container start -->
        <div class="main-container">

            <!-- Row start -->
            <div class="row gutters">
                <div class="col-xl-3 col-lg-3 col-md-12 col-sm-12 col-12">
                    <div class="card h-100">
                        <div class="card-body">
                            <div class="account-settings">
                                <div class="user-profile">
                                    <div class="user-avatar">
                                        <img src="https://cdn.jsdelivr.net/gh/AiPacino/kuaidashboard@main/assets/img/user.png" alt="Le Rouge Admin"/>
                                    </div>
                                    <h5 class="change-name">${nickname}</h5>
                                    <h6 class="change-email">${email}</h6>
                                </div>
                                <div class="list-group">
                                    <div class="list-group-item change-phone">${phone}</div>
                                    <a href="" class="list-group-item change-website">${website}</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-9 col-lg-9 col-md-12 col-sm-12 col-12">
                    <div class="card h-100">
                        <div class="card-header">
                            <div class="card-title">修改个人信息</div>
                        </div>
                        <div class="card-body">
                            <div class="row gutters">
                                <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6 col-12">
                                    <div class="form-group">
                                        <label for="user-nickname">昵称</label>
                                        <input type="text" class="form-control change-nickname" id="change-nickname"
                                               placeholder="昵称" v-model="nickname">
                                    </div>
                                    <div class="form-group">
                                        <label for="idUser">用户名</label>
                                        <input readonly type="text" class="form-control change-username"
                                               id="change-username"
                                               placeholder="用户ID" v-model="username">
                                    </div>
                                    <div class="form-group">
                                        <label for="user-phone">电话</label>
                                        <input type="text" class="form-control change-phone" id="change-phone"
                                               placeholder="输入电话号码" v-model="phone">
                                    </div>
                                    <div class="form-group">
                                        <label for="user-website">主页</label>
                                        <input type="url" class="form-control change-website" id="change-website"
                                               placeholder="主页链接" v-model="website">
                                    </div>
                                </div>
                                <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6 col-12">
                                    <div class="form-group">
                                        <label for="user-password">密码</label>
                                        <input type="password" class="form-control change-password" id="change-password"
                                               placeholder="输入新密码" v-model="new_password">
                                    </div>
                                    <div class="form-group">
                                        <label for="email">邮箱</label>
                                        <input type="email" class="form-control change-email" id="change-email"
                                               placeholder="邮箱地址" v-model="email">
                                    </div>
                                </div>
                                <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                                    <div class="text-right">
                                        <button type="button" v-on:click="updateUserInfo" class="btn btn-primary">保存
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Row end -->

        </div>
        <!-- Main container end -->

    </div>
    <!-- Page content end -->

</div>
<!-- Page wrapper end -->

<!--**************************
    **************************
        **************************
                    Required JavaScript Files
        **************************
    **************************
**************************-->
<!-- Required jQuery first, then Bootstrap Bundle JS -->
<script src="https://cdn.jsdelivr.net/gh/AiPacino/kuaidashboard@main/assets/js/base/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/AiPacino/kuaidashboard@main/assets/js/base/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/AiPacino/kuaidashboard@main/assets/js/base/moment.js"></script>


<!-- Main JS -->
<script src="https://cdn.jsdelivr.net/gh/AiPacino/kuaidashboard@main/assets/js/init.js"></script>
<script src="https://cdn.jsdelivr.net/gh/AiPacino/kuaidashboard@main/assets/js/base/vue.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/AiPacino/kuaidashboard@main/assets/js/base/axios.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/vue-toast-notification"></script>
<link href="https://cdn.jsdelivr.net/npm/vue-toast-notification/dist/theme-default.css" rel="stylesheet">

<script src="https://cdn.jsdelivr.net/gh/AiPacino/kuaidashboard@main/assets/js/common.js"></script>
<script>

    Vue.use(VueToast, {
        // One of the options
        position: 'bottom'
    });

    new Vue({
        el: '#main',
        delimiters: ['${', '}'],
        data: {
            avatar_path: "",
            created_at: "",
            email: "we",
            new_password: "",
            id: "",
            nickname: "",
            phone: "",
            updated_at: "",
            username: "",
            website: "",
            url: {
                apiHost: ApiHost + '/api/v1/status',
                apiUpdateUserInfo: ApiHost + '/api/v1/users'
            }
        },
        watch: {},
        created: function () {
            this.getStatus();
        },
        methods: {
            getStatus() {
                axios.post(this.url.apiHost, {},
                    {
                        headers: {
                            Authorization: localStorage.getItem('token')
                        }
                    }).then((response) => {
                    console.log(response.data.response)
                    this.avatar_path = response.data.response.avatar_path;
                    this.created_at = response.data.response.created_at;
                    this.email = response.data.response.email;
                    this.id = response.data.response.id;
                    this.nickname = response.data.response.nickname;
                    this.phone = response.data.response.phone;
                    this.updated_at = response.data.response.updated_at;
                    this.username = response.data.response.username;
                    this.website = response.data.response.website;


                }).catch(function (error) {
                    console.log(error);
                });
            },
            updateUserInfo() {
                axios.put(this.url.apiUpdateUserInfo,
                    JSON.stringify({
                        nickname: this.nickname,
                        username: this.username,
                        avatar_path: this.avatar_path,
                        email: this.email,
                        phone: this.phone,
                        website: this.website,
                        password: this.password,
                    }),
                    {
                        headers: {
                            Authorization: localStorage.getItem('token')
                        }
                    }).then((response) => {
                    Vue.$toast.success('保存成功.', {
                        duration: 5000,
                        // override the global option
                        position: 'top'
                    })
                }).catch(function (error) {
                    Vue.$toast.error('保存失败.', {
                        duration: 5000,
                        // override the global option
                        position: 'top'
                    })
                });
            }
        },
        filters: {
            human: function (value) {
                return Time.transform(value);
            }
        },
        computed: {}
    })
</script>
</body>
</html>
