<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Meta -->
    <meta name="description" content="Responsive Bootstrap4 Dashboard Template">
    <meta name="author" content="ParkerThemes">
    <link rel="shortcut icon" href="/dashboard/assets/img/fav.png"/>
    <meta http-equiv="Access-Control-Allow-Origin" content="*"/>

    <!-- Title -->
    <title>当前页面</title>

    <!-- *************
        ************ Common Css Files *************
    ************ -->
    <!-- Bootstrap css -->
    <link rel="stylesheet" href="/dashboard/assets/css/bootstrap.min.css">
    <!-- Icomoon Font Icons css -->
    <link rel="stylesheet" href="/dashboard/assets/fonts/style.css">
    <!-- Main css -->
    <link rel="stylesheet" href="/dashboard/assets/css/main.css">

    <!-- Bootstrap Select CSS -->
    <link rel="stylesheet" href="/dashboard/assets/vendor/bs-select/bs-select.css"/>
    <!-- *************
        ************ Vendor Css Files *************
    ************ -->
    <!-- DateRange css -->
    <link rel="stylesheet" href="/dashboard/assets/vendor/daterange/daterange.css"/>

    <!-- Notify -->
    <link rel="stylesheet" href="/dashboard/assets/vendor/notify/notify-flat.css"/>


</head>
<body>

<!-- Loading starts -->
<div id="loading-wrapper">
    <div class="spinner-border" role="status">
        <span class="sr-only">载入中...</span>
    </div>
</div>
<!-- Loading ends -->

<!-- Page wrapper start -->
<div class="page-wrapper" id="main">

    <!-- Sidebar wrapper start -->
    <nav id="sidebar" class="sidebar-wrapper">

        <!-- Sidebar brand start  -->
        <div class="sidebar-brand">
            <a href="../homepage/index.html" class="logo">
                <img src="/dashboard/assets//img/logo.png" alt="销售统计"/>
            </a>
        </div>
        <!-- Sidebar brand end  -->

        <!-- Sidebar content start -->
        <div class="sidebar-content">

            <!-- sidebar menu start -->
            <div class="sidebar-menu">
                <ul>
                    <li class="header-menu">常规</li>
                    <li>
                        <a href="/dashboard/dashboard.html">
                            <i class="icon-eye1"></i>
                            <span class="menu-text">销售统计</span>
                        </a>
                    </li>
                    <li>
                        <a href="/dashboard/pages.html">
                            <i class="icon-local_mall"></i>
                            <span class="menu-text">全部收款</span>
                        </a>
                    </li>
                    <li>
                        <a href="/dashboard/account.html">
                            <i class="icon-settings1"></i>
                            <span class="menu-text">账户设置</span>
                        </a>
                    </li>
                </ul>
            </div>
            <!-- sidebar menu end -->

        </div>
        <!-- Sidebar content end -->

    </nav>
    <!-- Sidebar wrapper end -->

    <!-- Page content start  -->
    <div class="page-content">

        <!-- Header start -->
        <header class="header">
            <div class="toggle-btns">
                <a id="toggle-sidebar" href="/dashboard/dashboard.html">
                    <i class="icon-list"></i>
                </a>
                <a id="pin-sidebar" href="/dashboard/dashboard.html">
                    <i class="icon-list"></i>
                </a>
            </div>
            <div class="header-items">
                <!-- Header actions start -->
                <ul class="header-actions">
                    <li class="dropdown">
                        <a href="../homepage/index.html#" id="userSettings" class="user-settings" data-toggle="dropdown"
                           aria-haspopup="true">
                            <span class="user-name" id="username-bar">${username}</span>
                            <span class="avatar">
										<img src="/dashboard/assets//img/user24.png" alt="avatar">
										<span class="status busy"></span>
									</span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="userSettings">
                            <div class="header-profile-actions">
                                <div class="header-user-profile">
                                    <div class="header-user">
                                        <img src="/dashboard/assets//img/user24.png" alt="Admin Template">
                                    </div>
                                    <h5 class="user-name">${username}</h5>
                                </div>
                                <a id="account-settings" href="/account"><i class="icon-settings1"></i>账户设置</a>
                                <a type="button" onclick="SignOut()"><i class="icon-log-out1"></i>退出登录</a>
                            </div>
                        </div>
                    </li>
                </ul>
                <!-- Header actions end -->
            </div>
        </header>
        <!-- Header end -->

        <!-- Page header start -->
        <div class="page-header">
            <ol class="breadcrumb">
                <li class="breadcrumb-item">主页</li>
                <li class="breadcrumb-item active">销售统计</li>
            </ol>

            <ul class="app-actions">
                <li>
                    <a class="link" id="reportrange">
                        <span class="range-text"></span>
                        <i class="icon-chevron-down"></i>
                    </a>
                </li>
            </ul>
        </div>
        <!-- Page header end -->

        <!-- Main container start -->
        <div class="main-container">

            <!-- Row start -->
            <div class="row gutters">
                <div class="col-xl-3 col-lg-3 col-md-6 col-sm-6 col-12">
                    <div class="info-stats4">
                        <div class="info-icon">
                            <i class="icon-eye1"></i>
                        </div>
                        <div class="sale-num">
                            <h3 id="visitors_total">${visitors_total}</h3>
                            <p>总访客数</p>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-lg-3 col-md-6 col-sm-6 col-12">
                    <div class="info-stats4">
                        <div class="info-icon">
                            <i class="icon-shopping-cart1"></i>
                        </div>
                        <div class="sale-num">
                            <h3 id="orders_total">${orders_total}</h3>
                            <p>总订单数</p>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-lg-3 col-md-6 col-sm-6 col-12">
                    <div class="info-stats4">
                        <div class="info-icon">
                            <i class="icon-shopping-bag1"></i>
                        </div>
                        <div class="sale-num">
                            <h3 id="deals_total">${deals_total}</h3>
                            <p>总付款数</p>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-lg-3 col-md-6 col-sm-6 col-12">
                    <div class="info-stats4">
                        <div class="info-icon">
                            <i class="icon-activity"></i>
                        </div>
                        <div class="sale-num">
                            <h3 id="income_total">${income_total}</h3>
                            <p>总成交额</p>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Row end -->

            <!-- Row start -->
            <div class="row gutters">
                <div class="col-xl-4 col-lg-4 col-md-6 col-sm-12 col-12">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">总访客数</div>
                        </div>
                        <div class="card-body pt-0">
                            <div id="visitors"></div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-4 col-lg-4 col-md-6 col-sm-12 col-12">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">总成交量</div>
                        </div>
                        <div class="card-body pt-0">
                            <div id="deals"></div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-4 col-lg-4 col-md-6 col-sm-12 col-12">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">总成交额</div>
                        </div>
                        <div class="card-body pt-0">
                            <div id="income"></div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Row end -->

        </div>
        <!-- Main container end -->

    </div>
    <!-- Page content end -->

</div>
<!-- Page wrapper end -->

<script src="/dashboard/assets//vendor/apex/apexcharts.min.js"></script>
<script src="/dashboard/assets//vendor/apex/examples/mixed/line-column-graph.js"></script>

<!--**************************
    **************************
        **************************
                    Required JavaScript Files
        **************************
    **************************
**************************-->
<!-- Required jQuery first, then Bootstrap Bundle JS -->
<script src="/dashboard/assets//js/base/jquery.min.js"></script>
<script src="/dashboard/assets//js/base/bootstrap.bundle.min.js"></script>
<script src="/dashboard/assets//js/base/moment.js"></script>


<!-- *************
    ************ Vendor Js Files *************
************* -->
<!-- Slimscroll JS -->
<script src="/dashboard/assets//vendor/slimscroll/slimscroll.min.js"></script>
<script src="/dashboard/assets//vendor/slimscroll/custom-scrollbar.js"></script>

<!-- Daterange -->
<script src="/dashboard/assets//vendor/daterange/daterange.js"></script>
<script src="/dashboard/assets//vendor/daterange/custom-daterange.js"></script>

<!-- Bootstrap Select JS -->
<script src="/dashboard/assets//vendor/bs-select/bs-select.min.js"></script>
<!-- Polyfill JS -->
<script src="/dashboard/assets//vendor/polyfill/polyfill.min.js"></script>

<!-- Notify js -->
<script src="/dashboard/assets//js/base/jquery.easing.1.3.js"></script>
<script src="/dashboard/assets//vendor/notify/notify.js"></script>
<script src="/dashboard/assets//vendor/notify/notify-custom.js"></script>
<script>
    $.fn.modal.Constructor.prototype._enforceFocus = function() {};
</script>
<!-- Main JS -->
<script src="/dashboard/assets//js/common.js"></script>
<script src="/dashboard/assets//js/utils/clipboard.min.js"></script>
<script src="/dashboard/assets//js/utils/tools.js"></script>
<script src="/dashboard/assets//js/utils/URI.js"></script>
<script src="/dashboard/assets//js/utils/url.js"></script>
<script src="/dashboard/assets//js/utils/ajax.js"></script>
<script src="/dashboard/assets//js/utils/att.js"></script>
<script src="/dashboard/assets//js/views/login.js"></script>
<script src="/dashboard/assets//js/views/checkout/order.js"></script>
<script src="/dashboard/assets//js/views/pages/new.js"></script>
<script src="/dashboard/assets//js/views/user.js"></script>
<script src="/dashboard/assets//js/router.js"></script>
<script src="/dashboard/assets//js/views/pages/variant.js"></script>
<script src="/dashboard/assets//js/init.js"></script>
<script src="/dashboard/assets//vendor/apex/admin/customers.js"></script>
<!-- Apex Charts -->
<script src="/dashboard/assets//js/base/vue.min.js"></script>
<script src="/dashboard/assets//js/base/axios.min.js"></script>
<script>
    let where = window.location.href.toLowerCase();
    let id = GetPageIdFromUrl(/pages\/([0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12})/i, where);

    new Vue({
        el: '#main',
        delimiters: ['${', '}'],
        data: {
            visitors_total: 0,
            username: "",
            orders_total: 0,
            deals_total: 0,
            income_total: 0,
            url: {
                apiHost: ApiHost + '/api/v1/dashboard',
            }
        },
        watch: {},
        created: function () {
            axios.post(this.url.apiHost, JSON.stringify({
                    'start': start,
                    'end': end,
                }),
                {
                    headers: {
                        Authorization: localStorage.getItem('token')
                    }
                }).then((response) => {
                console.log(response.data)
                this.visitors_total = response.data.response.visitors
                this.orders_total = response.data.response.orders
                this.deals_total = response.data.response.deals
                this.income_total = parseInt(response.data.response.income)

                if (response.data.response.daily_income.key != null) {
                    let IncomeChartOptions = {
                        chart: {
                            id: 'income',
                            height: 275,
                            type: 'area',
                            toolbar: {
                                show: false,
                            },
                        },
                        dataLabels: {
                            enabled: true
                        },
                        stroke: {
                            curve: 'smooth',
                            width: 4
                        },
                        series: [],
                        grid: {
                            row: {
                                colors: ['#ffffff'], // takes an array which will be repeated on columns
                                opacity: 0.5
                            },
                        },
                        xaxis: {},
                        colors: ['#225de4', '#888888'],
                        markers: {
                            size: 5,
                            opacity: 0.2,
                            colors: ['#225de4', '#888888'],
                            strokeColor: "#fff",
                            strokeWidth: 3,
                            hover: {
                                size: 7,
                            }
                        },
                        tooltip: {
                            x: {
                                format: 'dd/MM/yy'
                            },
                        },
                        noData: {
                            text: "正在载入数据中",
                            align: 'center',
                            verticalAlign: 'middle',
                            offsetX: 0,
                            offsetY: 0
                        }
                    }

                    let IncomeChart = new ApexCharts(
                        document.querySelector("#income"),
                        IncomeChartOptions,
                    );
                    IncomeChart.render();

                    let xaxis = {};
                    let series = [];

                    console.log(response.data.response.daily_income.key)
                    console.log(response.data.response.daily_income.value)
                    xaxis = {
                        type: 'datetime',
                        allowDecimals: false,
                        categories: response.data.response.daily_income.key,
                        labels: {
                            formatter: function (val) {
                                return moment(val).format("M月DD日");
                            }
                        }
                    };

                    series = {
                        name: "人民币",
                        data: response.data.response.daily_income.value.map(x => parseInt(x)),
                        labels: {
                            formatter: function (val) {
                                return val + "sf";
                            }
                        }
                    };

                    ApexCharts.exec('income', "updateOptions", {
                        xaxis: xaxis,
                    });

                    ApexCharts.exec('income', "updateSeries", [
                        series
                    ]);
                }

                if (response.data.response.daily_deals.key != null) {

                    let DealsChartOptions = {
                        chart: {
                            id: 'deals',
                            height: 275,
                            type: 'area',
                            toolbar: {
                                show: false,
                            },
                        },
                        dataLabels: {
                            enabled: true
                        },
                        stroke: {
                            curve: 'smooth',
                            width: 4
                        },
                        series: [],
                        grid: {
                            row: {
                                colors: ['#ffffff'], // takes an array which will be repeated on columns
                                opacity: 0.5
                            },
                        },
                        xaxis: {},
                        colors: ['#225de4', '#888888'],
                        markers: {
                            size: 5,
                            opacity: 0.2,
                            colors: ['#225de4', '#888888'],
                            strokeColor: "#fff",
                            strokeWidth: 3,
                            hover: {
                                size: 7,
                            }
                        },
                        tooltip: {
                            x: {
                                format: 'dd/MM/yy'
                            },
                        },
                        noData: {
                            text: "没有数据",
                            align: 'center',
                            verticalAlign: 'middle',
                            offsetX: 0,
                            offsetY: 0
                        }
                    }

                    let DealsChart = new ApexCharts(
                        document.querySelector("#deals"),
                        DealsChartOptions,
                    );
                    DealsChart.render();

                    let xaxis = {};
                    let series = [];
                    xaxis = {
                        type: 'datetime',
                        categories: response.data.response.daily_deals.key,
                        labels: {
                            formatter: function (val) {
                                return moment(val).format("M月DD日");
                            }
                        }
                    };

                    series = {
                        name: "人民币:",
                        data: response.data.response.daily_deals.value,
                        labels: {
                            formatter: function (val) {
                                return val;
                            }
                        }
                    };

                    ApexCharts.exec('deals', "updateOptions", {
                        xaxis: xaxis
                    });

                    ApexCharts.exec('deals', "updateSeries", [
                        series
                    ]);
                }

                if (response.data.response.daily_visitor.key != null) {
                    let VisitorChartOptions = {
                        chart: {
                            id: 'visitors',
                            height: 275,
                            type: 'area',
                            toolbar: {
                                show: false,
                            },
                        },
                        dataLabels: {
                            enabled: true
                        },
                        stroke: {
                            curve: 'smooth',
                            width: 4
                        },
                        series: [],
                        grid: {
                            row: {
                                colors: ['#ffffff'], // takes an array which will be repeated on columns
                                opacity: 0.5
                            },
                        },
                        xaxis: {},
                        colors: ['#225de4', '#888888'],
                        markers: {
                            size: 5,
                            opacity: 0.2,
                            colors: ['#225de4', '#888888'],
                            strokeColor: "#fff",
                            strokeWidth: 3,
                            hover: {
                                size: 7,
                            }
                        },
                        tooltip: {
                            x: {
                                format: 'dd/MM/yy'
                            },
                        },
                        noData: {
                            text: "正在载入访客数据中",
                            align: 'center',
                            verticalAlign: 'middle',
                            offsetX: 0,
                            offsetY: 0
                        }
                    };

                    let VisitorChart = new ApexCharts(
                        document.querySelector("#visitors"),
                        VisitorChartOptions,
                    );
                    VisitorChart.render();

                    let xaxis = {};
                    let series = [];
                    xaxis = {
                        type: 'datetime',
                        categories: response.data.response.daily_visitor.key,
                        labels: {
                            formatter: function (val) {
                                return moment(val).format("M月DD日");
                            }
                        }
                    };

                    series = {
                        name: "访客人数:",
                        data: response.data.response.daily_visitor.value,
                        labels: {
                            formatter: function (val) {
                                return val;
                            }
                        }
                    };

                    ApexCharts.exec('visitors', "updateOptions", {
                        xaxis: xaxis
                    });

                    ApexCharts.exec('visitors', "updateSeries", [
                        series
                    ]);
                }
            }).catch(function (error) {
                console.log(error);
            });
        },
        methods: {
            getHashtags() {
                axios.get(this.url.hashtags).then((response) => {
                    // this.hashtags = response.data;
                    console.log(response.data);

                });
            },
            getCities() {
                axios.get(this.url.cities).then((response) => {
                    // this.cities = response.data;
                    console.log(response.data);
                });
            }
        }
    })
</script>

</body>
</html>
