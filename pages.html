<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Meta -->
    <meta name="description" content="Responsive Bootstrap4 Dashboard Template">
    <meta name="author" content="ParkerThemes">
    <link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/AiPacino/kuaidashboard@main/assets//img/fav.png"/>
    <meta http-equiv="Access-Control-Allow-Origin" content="*"/>

    <!-- Title -->
    <title>当前页面</title>

    <!-- *************
        ************ Common Css Files *************
    ************ -->
    <!-- Bootstrap css -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/AiPacino/kuaidashboard@main/assets//css/bootstrap.min.css">
    <!-- Icomoon Font Icons css -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/AiPacino/kuaidashboard@main/assets//fonts/style.css">
    <!-- Main css -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/AiPacino/kuaidashboard@main/assets//css/main.css">

    <!-- Bootstrap Select CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/AiPacino/kuaidashboard@main/assets//vendor/bs-select/bs-select.css"/>
    <!-- *************
        ************ Vendor Css Files *************
    ************ -->
    <!-- DateRange css -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/AiPacino/kuaidashboard@main/assets//vendor/daterange/daterange.css"/>

    <!-- Notify -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/AiPacino/kuaidashboard@main/assets//vendor/notify/notify-flat.css"/>


</head>
<body>

<!-- Loading starts -->
<div id="loading-wrapper">
    <div class="spinner-border" role="status">
        <span class="sr-only">载入中...</span>
    </div>
</div>
<!-- Loading ends -->
<!-- Page wrapper start -->
<div class="page-wrapper">

    <!-- Sidebar wrapper start -->
    <nav id="sidebar" class="sidebar-wrapper">

        <!-- Sidebar brand start  -->
        <div class="sidebar-brand">
            <a href="../homepage/index.html" class="logo">
                <img src="https://cdn.jsdelivr.net/gh/AiPacino/kuaidashboard@main/assets//img/logo.png" alt="销售统计"/>
            </a>
        </div>
        <!-- Sidebar brand end  -->

        <!-- Sidebar content start -->
        <div class="sidebar-content">

            <!-- sidebar menu start -->
            <div class="sidebar-menu">
                <ul>
                    <li class="header-menu">常规</li>
                    <li>
                        <a href="/dashboard/dashboard.html">
                            <i class="icon-eye1"></i>
                            <span class="menu-text">销售统计</span>
                        </a>
                    </li>
                    <li>
                        <a href="/dashboard/pages.html">
                            <i class="icon-local_mall"></i>
                            <span class="menu-text">全部收款</span>
                        </a>
                    </li>
                    <li>
                        <a href="/dashboard/account.html">
                            <i class="icon-settings1"></i>
                            <span class="menu-text">账户设置</span>
                        </a>
                    </li>
                </ul>
            </div>
            <!-- sidebar menu end -->

        </div>
        <!-- Sidebar content end -->

    </nav>
    <!-- Sidebar wrapper end -->

    <!-- Page content start  -->
    <div class="page-content">

        <!-- Header start -->
        <header class="header">
            <div class="toggle-btns">
                <a id="toggle-sidebar" href="default-layout.html#">
                    <i class="icon-list"></i>
                </a>
                <a id="pin-sidebar" href="default-layout.html#">
                    <i class="icon-list"></i>
                </a>
            </div>
            <div class="header-items">
                <!-- Header actions start -->
                <ul class="header-actions">
                    <li class="dropdown">
                        <a href="../homepage/index.html#" id="userSettings" class="user-settings" data-toggle="dropdown"
                           aria-haspopup="true">
                            <span class="user-name" id="username-bar">${username}</span>
                            <span class="avatar">
										<img src="https://cdn.jsdelivr.net/gh/AiPacino/kuaidashboard@main/assets//img/user24.png" alt="avatar">
										<span class="status busy"></span>
									</span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="userSettings">
                            <div class="header-profile-actions">
                                <div class="header-user-profile">
                                    <div class="header-user">
                                        <img src="https://cdn.jsdelivr.net/gh/AiPacino/kuaidashboard@main/assets//img/user24.png" alt="Admin Template">
                                    </div>
                                    <h5 class="user-name">${username}</h5>
                                </div>
                                <a id="account-settings" href="/account"><i class="icon-settings1"></i>账户设置</a>
                                <a type="button" onclick="SignOut()"><i class="icon-log-out1"></i>退出登录</a>
                            </div>
                        </div>
                    </li>
                </ul>
                <!-- Header actions end -->
            </div>
        </header>
        <!-- Header end -->

        <!-- Page header start -->
        <div class="page-header">
            <ol class="breadcrumb">
                <li class="breadcrumb-item">主页</li>
                <li class="breadcrumb-item active">所有收款页</li>
            </ol>
        </div>
        <!-- Page header end -->

        <!-- Main container start -->
        <div class="main-container">

            <!-- Row starts -->
            <div class="row gutters">
                <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                    <div class="card">
                        <div class="card-header border-bottom-0">
                            <div class="row gutters">
                                <div class="col mr-auto">
                                    <!-- Button trigger modal -->
                                    <button type="button" class="btn btn-primary" data-toggle="modal"
                                            data-target="#customModalTwo">
                                        新建收款页
                                    </button>

                                    <!-- Modal -->
                                    <div class="modal fade" id="customModalTwo" tabindex="-1" role="dialog"
                                         aria-labelledby="customModalTwoLabel" aria-hidden="true">
                                        <div class="modal-dialog" role="document">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="customModalTwoLabel">新建收款页</h5>
                                                    <button type="button" class="close" data-dismiss="modal"
                                                            aria-label="Close">
                                                        <span aria-hidden="true">&times;</span>
                                                    </button>
                                                </div>
                                                <div class="modal-body">
                                                    <form>
                                                        <label for="recipient-name"
                                                               class="col-form-label ">宝贝名称</label>
                                                        <div class="form-group text-right">
                                                            <input type="text" class="form-control" id="page_title">
                                                        </div>
                                                        <label for="recipient-name"
                                                               class="col-form-label ">价格</label>
                                                        <div class="form-group text-right">
                                                            <div class="input-group">
                                                                <input type="text" id="price"
                                                                       class="form-control text-right"
                                                                       name="currency-field"
                                                                       pattern="^\d{1,3}(,\d{3})*(\.\d+)?" value=""
                                                                       data-type="currency" placeholder="9.00">
                                                                <div class="input-group-append">
                                                                <span class="input-group-text"
                                                                      id="basic-addon2">元</span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </form>
                                                </div>
                                                <div class="modal-footer custom">
                                                    <div class="left-side">
                                                        <button type="button" class="btn btn-link danger"
                                                                data-dismiss="modal">取消
                                                        </button>
                                                    </div>
                                                    <div class="divider"></div>
                                                    <div class="right-side">
                                                        <button type="button" onclick="NewPage()"
                                                                class="btn btn-link success">新建
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-body" id="main">
                            <div class="popular-posts" id="popular-posts">
                                <a v-for="item in posts" :href="`/pages/edit.html?id=${item.id}`">
                                    <img src="https://cdn.jsdelivr.net/gh/AiPacino/kuaidashboard@main/assets//img/img4.jpg" class="post-img" alt="Le Rouge Blog Post"/>
                                    <div class="post-content">
                                        <h6 class="post-title">${item.title}</h6>
                                        <h6 class="post-date">
                                            <span class="category">${item.price}元</span>
                                            <span class="divider">/</span>
                                            <span class="date">${item.updated_at | human}</span>
                                        </h6>
                                    </div>
                                    <div class="col ml-auto">
                                        <button class="btn btn-primary btn-lg" style="float: right" data-toggle="modal"
                                                data-target="#addNewTask">修改
                                        </button>
                                    </div>
                                </a>
                            </div>
                            <div class="card-footer">
                                <nav aria-label="navigation">
                                    <ul class="pagination justify-content-center info">
                                        <li class="page-item disabled" v-if="page != 1"
                                            @click="page--">
                                            <a class="page-link" href="#"><i class="icon-chevron-left1"></i>前一页</a></li>

                                        </li>
                                        <li class="page-item active" v-for="pageNumber in pages.slice(page-1, page+5)"
                                            v-if="page == pageNumber"
                                            @click="page = pageNumber"><a class="page-link" href="#">${pageNumber}</a>
                                        </li>
                                        <li class="page-item" v-for="pageNumber in pages.slice(page-1, page+5)"
                                            v-if="page != pageNumber"
                                            @click="page = pageNumber"><a class="page-link" href="#">${pageNumber}</a>
                                        </li>
                                        <li class="page-item" @click="page++" v-if="page < pages.length">
                                            <a class="page-link" href="#">下一页<i
                                                        class="icon-chevron-right1"></i></a></li>
                                    </ul>
                                </nav>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Row ends -->

        </div>
        <!-- Main container end -->

    </div>
    <!-- Page content end -->

</div>
<!-- Page wrapper end -->
<script src="https://cdn.jsdelivr.net/gh/AiPacino/kuaidashboard@main/assets/js/base/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/AiPacino/kuaidashboard@main/assets/js/base/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/AiPacino/kuaidashboard@main/assets/js/base/moment.js"></script>
<script src="https://cdn.jsdelivr.net/gh/AiPacino/kuaidashboard@main/assets/js/init.js"></script>
<script src="https://cdn.jsdelivr.net/gh/AiPacino/kuaidashboard@main/assets/js/common.js"></script>
<script src="https://cdn.jsdelivr.net/gh/AiPacino/kuaidashboard@main/assets/js/base/vue.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/AiPacino/kuaidashboard@main/assets/js/base/human.js"></script>
<script src="https://cdn.jsdelivr.net/gh/AiPacino/kuaidashboard@main/assets/js/base/axios.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/AiPacino/kuaidashboard@main/assets/js/base/vue-paginate.js"></script>
<script>
    // Jquery Dependency

    $("input[data-type='currency']").on({
        keyup: function () {
            formatCurrency($(this));
        },
        blur: function () {
            formatCurrency($(this), "blur");
        }
    });

    function Ajax() {
        let ajaxData = {
            type: arguments[0].type || "POST",
            url: arguments[0].url || "",
            async: arguments[0].async || "true",
            data: arguments[0].data || null,
            dataType: arguments[0].dataType || "json",
            contentType: arguments[0].contentType || "application/json",
            beforeSend: arguments[0].beforeSend || function () {
            },
            success: arguments[0].success || function () {
            },
            error: arguments[0].error || function () {
            }
        }
        ajaxData.beforeSend()
        let xhr = createxmlHttpRequest();
        xhr.responseType = ajaxData.dataType;
        xhr.open(ajaxData.type, ajaxData.url, ajaxData.async);
        xhr.setRequestHeader("Content-Type", ajaxData.contentType);
        if (localStorage.getItem('token')) {
            xhr.setRequestHeader("Authorization", localStorage.getItem('token'));
        }
        xhr.send(convertData(ajaxData.data));
        xhr.onreadystatechange = function () {
            if (xhr.readyState == XMLHttpRequest.DONE) {
                if (xhr.status == 200) {
                    ajaxData.success(xhr.response)
                } else if (xhr.status == 201) {
                    ajaxData.success(xhr.response)
                } else {
                    ajaxData.error(xhr)
                }
            }
        }
    }

    function createxmlHttpRequest() {
        if (window.ActiveXObject) {
            return new ActiveXObject("Microsoft.XMLHTTP");
        } else if (window.XMLHttpRequest) {
            return new XMLHttpRequest();
        }
    }

    function convertData(data) {
        return JSON.stringify(data)
    }

    function NewPage() {
        let page_title = document.getElementById("page_title").value;
        let price = document.getElementById("price").value;

        Ajax({
            url: ApiHost + '/api/v1/posts',
            data: {
                'title': page_title,
                'price': price,
            },
            success: function (res) {
                location.reload();
            },
            error: function (res) {
                console.log(res.error)
            }
        });
    }

    function formatNumber(n) {
        // format number 1000000 to 1,234,567
        return n.replace(/\D/g, "").replace(/\B(?=(\d{3})+(?!\d))/g, ",")
    }


    function formatCurrency(input, blur) {
        // appends $ to value, validates decimal side
        // and puts cursor back in right position.

        // get input value
        var input_val = input.val();

        // don't validate empty input
        if (input_val === "") {
            return;
        }

        // original length
        var original_len = input_val.length;

        // initial caret position
        var caret_pos = input.prop("selectionStart");

        // check for decimal
        if (input_val.indexOf(".") >= 0) {

            // get position of first decimal
            // this prevents multiple decimals from
            // being entered
            var decimal_pos = input_val.indexOf(".");

            // split number by decimal point
            var left_side = input_val.substring(0, decimal_pos);
            var right_side = input_val.substring(decimal_pos);

            // add commas to left side of number
            left_side = formatNumber(left_side);

            // validate right side
            right_side = formatNumber(right_side);

            // On blur make sure 2 numbers after decimal
            if (blur === "blur") {
                right_side += "00";
            }

            // Limit decimal to only 2 digits
            right_side = right_side.substring(0, 2);

            // join number by .
            input_val = "" + left_side + "." + right_side;

        } else {
            // no decimal entered
            // add commas to number
            // remove all non-digits
            input_val = formatNumber(input_val);
            input_val = "" + input_val;

            // final formatting
            if (blur === "blur") {
                input_val += ".00";
            }
        }

        // send updated string to input
        input.val(input_val);

        // put caret back in the right position
        var updated_len = input_val.length;
        caret_pos = updated_len - original_len + caret_pos;
        input[0].setSelectionRange(caret_pos, caret_pos);
    }
</script>
<script>

    let where = window.location.href.toLowerCase();

    new Vue({
        el: '#main',
        delimiters: ['${', '}'],
        data: {
            posts: [],
            baseUrl: ApiHost + '/api/v1/user_posts',
            page: 1,
            perPage: 8,
            pages: [],
            record: [],
        },
        computed: {
            displayedPosts() {
                return this.paginate(this.posts);
            }
        },
        watch: {
            posts() {
                this.setPages();
            },
            page() {
                this.getPosts();
                console.log("当前页面为", this.page)
            }
        },
        created() {
            console.log("开始")
            this.getPosts();
        },
        methods: {
            getPosts() {
                axios.post(this.baseUrl, JSON.stringify({
                        'page': this.page,
                        'limit': this.perPage,
                    }),
                    {
                        headers: {
                            Authorization: localStorage.getItem('token')
                        }
                    }).then((response) => {
                    this.posts = response.data.response.records
                    this.resp = response.data.response
                }).catch(function (error) {
                    console.log(error);
                });
            },
            setPages() {
                let numberOfPages = Math.ceil(this.resp.length / this.perPage);
                numberOfPages = this.resp.total_page;
                for (let index = 1; index <= numberOfPages; index++) {
                    this.pages.push(index);
                }
            },
            paginate(posts) {
                let page = this.page;
                let perPage = this.perPage;
                let from = (page * perPage) - perPage;
                let to = (page * perPage);
                return posts.slice(from, to);
            },
        },
        filters: {
            human: function (value) {
                return Time.transform(value);
            }
        }
    })
</script>
</body>
</html>
